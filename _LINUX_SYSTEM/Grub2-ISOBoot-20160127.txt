filename: Grub2_ISOBoot_20160127.txt
https://help.ubuntu.com/community/Grub2/ISOBoot

Grub2/ISOBoot

Introduction
Ubuntu ISOs are designed to allow booting directly from the hard drive using GRUB 2 and eliminates the need
for burning a CD/DVD. This feature permits the user to boot and use the "Try Ubuntu" feature of the Ubuntu
installation CD as well as to install Ubuntu directly from an ISO on the hard drive. In addition to Ubuntu
ISOs, many other Linux distributions as well as popular rescue CDs can be booted directly from an ISO file.

In order to use this feature, GRUB 2 must already be installed on the system. GRUB Legacy
can not use this feature.

All GRUB references on this page refer to GRUB 2 (version 1.97 or later) unless otherwise noted.

This guide will detail how to:

Download and store Ubuntu ISOs
Create a GRUB 2 menuentry for running the ISO directly from a file
Install Ubuntu directly from an ISO file via the GRUB 2 menu
Additionally, examples of GRUB 2 menuentries for other operating system and utility CDs are provided on
the Grub2/ISOBoot/Examples page.

Downloading the ISO
Downloading
The user should decide beforehand which ISO to download. The Desktop version is available in 32-bit and
64-bit versions. The 32-bit version (-i386) will run on a 64-bit computer, but a 64-bit version (-amd64)
will not run on a 32-bit computer. There are also Server versions, as well as an Alternate CD version
for users having special requirements or using RAID and/or LVM.

Ubuntu CD/DVDs can be downloaded from the official Ubuntu site: Ubuntu Download page. Links to installation
help and alternative download sites are accessible from that page as well.

ISO File Location
The Ubuntu default download location is normally to the user's Downloads folder, but the ISO may also
appear on the Desktop or another location defined by the user. The Desktop version filename for officially
released versions of Ubuntu uses the format of ubuntu-XX.XX-desktop-amd64.iso for the 64-bit version and
ubuntu-XX.XX-desktop-i386.iso for the 32-bit version, with XX.XX being the release number (such as 12.04,
11.10, etc).

Storing the ISO
Once downloaded, the user must decide where to store the file. Typically, the ISO CD image is approximately
700 MB, while the DVD version is even larger. Storing it on a non-system partition should be considered
if space is limited on the system (/) partition. Additionally, users making system backups might wish
to exclude the folder in which the ISO is stored if the file remains on the system (/) partition.

For purposes of this guide, the ISO will be placed in the user's Downloads folder (/home/username/Downloads).

Note: Storing the ISO file in /boot is not recommended if you are using a small, separate /boot partition.

The ISO file may be stored on any partition accessible to GRUB 2. The partition format does not need to
be ext3/4.
If stored on a partition with a different format than the system, the filesystem's module (ntfs, reiserfs,
etc) may need to be included in the menuentry for GRUB to be able to access the file.
The ISO can remain on the system partition (/) if desired.
If the system uses a separate partition for a system folder such as /home or /boot, the user must ensure
to properly identify the location of the ISO in the menuentry's PATH. In such cases, since the partition
is directly mounted by GRUB 2, the address would not include /home or /boot.

Exploring the ISO Contents
There are several methods the user can employ to examine the contents of the ISO file. Viewing the folders
and files contained in an ISO can help determine menuentry path designations and the names assigned to
system folders and files. The two most important files contained on the ISO, for building the menuentry,
are the kernel and the initrd image. These files reside in the casper folder on a standard Ubuntu ISO. The
kernel link is vmlinuz and the image file is initrd.img.

On other bootable Linux ISOs and utility CDs, these files may be located in other folders and may be
named differently (vmlinuz0, initramfs, etc). Note that some non-Ubuntu ISOs contain an initrd image
with a .gz extension rather than the .lz extension now used by Ubuntu.

Archive Manager
Archive Manager/File Roller is a GUI application which can inspect the contents of an ISO file. Archive
Manager can be started in the following ways:

In Nautilus, right click the ISO and select "Open with Archive Manager".
Via the DASH Home button (top left of screen). Type "Archive Manager" and press ENTER.
Via terminal using file-roller or gksu file-roller

Command Line
The user can mount the ISO image via a terminal and then inspect the contents via commands or opening
a file browser. To mount the ISO via the terminal:

Boot into your normal Linux operating system.
Create a specific mount point, if desired. An existing mount point may also be used.
Mount the ISO
Example: sudo mount -o loop /home/username/Downloads/ubuntu-desktop-amd64.iso /mnt/iso/

Open a file browser to view the contents
sudo mkdir /mnt/iso # Optional - the ISO file can be mounted on an existing mount point if desired.
sudo mount -o loop /<path>/<filename>.iso /mnt/iso
gksu nautilus /mnt/iso
sudo umount /mnt/iso # When finished inspecting the contents.
GRUB Terminal
GRUB 2's terminal operations permit exploring the contents of partitions and ISO images. The following
GRUB commands may be helpful if an error message is generated after attempting to boot an ISO menuentry:

ls

Display partitions known to GRUB.

ls (hdX,Y)/

Display the contents of the / folder on /dev/sdXY

To mount an ISO via the GRUB terminal, determine the location/path of the ISO file, then:

loopback loop (hdX,Y)/<path>/<filename.iso>

Example: loopback loop (hd0,5)/my_isos/ubuntu-12.04-desktop-amd64.iso

Once mounted via the above command, the ISO can be inspected using the ls command. The ISO will be
mounted on "(loop)".

ls (loop)/

ls (loop)/casper

On an Ubuntu ISO, this should display vmlinuz and initrd.img, among other files.

Creating the GRUB 2 Menuentry
There are several methods to create a GRUB 2 menuentry which will boot an Ubuntu ISO. Two options are
provided below - using the grml-rescueboot package to automatically create the menuentry, or manually
editing the GRUB 2 configuration scripts/files.

There is also a method to create USB [multi]boot pendrives (almost) automatically, grub-n-iso_multiboot.

grml-rescueboot
A very simple way of creating a GRUB menuentry for a bootable ISO file is to use grml-rescueboot.

The package does the following:

Creates a /boot/grml folder.
Automatically adds menuentries to the GRUB menu for any ISO files located in the /boot/grml folder. This
is accomplished whenever the update-grub command is executed.

The created menuentry, when selected, provides submenu options on how to boot the ISO, including the
"Try Ubuntu" and "Install" options.
To use the grml-rescueboot option:

Install grml-rescueboot

sudo apt-get install grml-rescueboot
Place bootable ISO files in the /boot/grml folder.

Since this is a system folder, the operation must be conducted as "root". For example, if the ISO is
located in the user's Downloads folder, the command would be:
sudo mv ~/Downloads/<filename.iso> /boot/grml/
Update GRUB
sudo update-grub
grub-n-iso_multiboot
A simple way to create a USB [multi]boot drive including the grub bootloader and the GRUB menuentries
for Ubuntu ISO files is to use grub-n-iso_multiboot with the shell-script file mk-grub-n-iso. It does
the main part of the work automatically with the help of a couple of files for the configuration of the
booting system.

The shell-script is made to be easy to use, but it helps if you have some experience with terminal
windows and command lines.

Make a USB pendrive that can boot (almost) all PCs

It is possible to create the pendrive in either UEFI mode or BIOS mode, and the two grub installations
are simply done with two different command lines.


$ grep grub-install mk-grub-n-iso
grub-install --force --removable --no-floppy --boot-directory=/mnt/target/boot
--efi-directory=/mnt/target/EFI/BOOT "$2"
grub-install --force --removable --no-floppy --boot-directory=/mnt/target/boot "$2"
This tool works in an Ubuntu family operating system of version 14.04 LTS or newer. (It is possible to
use Ubuntu 12.04 LTS too, but it has an older version of grub, and this method works only for BIOS mode.)

64-bit versions work only in 64-bit computers. 32-bit versions work in 32-bit and 64-bit computer with
BIOS, and now also with UEFI. It is possible to create 'grub-n-iso' pendrives that boot most PCs with
Intel and AMD processors according to the following links,

How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images

Build your own single boot or multiboot pendrive for all PC (Intel/AMD) computers

The pendrive 'behind' the following grub menu was created with the command line

sudo ./mk-grub-n-iso multiboot /dev/sdx
using links in the directory 'grub-n-iso_multiboot' to the target iso files. The only manual tasks were
to answer a few questions (one-character replies), and the use gparted to edit partitions according to
guidelines by the script itself (partition sizes, file system types: fat32 and ext2).

5-grub-n-iso_multiboot_720x400.png

Manually editing the GRUB files
Another way to create a GRUB menuentry is to add it to the /etc/grub.d/40_custom file. Add the menuentry
below the existing lines in the file.

Open the /etc/grub.d/40_custom file as root with a text editor.
gksu gedit /etc/grub.d/40_custom
Add the menuentry.
Save the file.
Update the GRUB 2 menu.
sudo update-grub
Menuentry Example

The following is an example GRUB menuentry for Ubuntu 12.04's 64-bit ISO, located in the user's Downloads
folder of sda5.

important.png Updated releases of Ubuntu 12.04 and later may designate the 64-bit kernel as vmlinuz.efi. This
file is still located in the /casper folder. When creating the menuentry, use vmlinuz.efi rather than
vmlinuz in the linux line for the 64-bit version.

 menuentry "Ubuntu 12.04 ISO" {
         set isofile="/home/<username>/Downloads/ubuntu-12.04-desktop-i386.iso"
         # or set isofile="/<username>/Downloads/ubuntu-12.04-desktop-i386.iso"
         # if you use a single partition for your $HOME
         loopback loop (hd0,5)$isofile
         linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile noprompt noeject
         initrd (loop)/casper/initrd.lz
 }
For the 64-bit version of Ubuntu 12.04 (update 2):

menuentry "Ubuntu 12.04.2 ISO" {
        set isofile="/home/<username>/Downloads/ubuntu-12.04.2-desktop-amd64.iso"
        # or set isofile="/<username>/Downloads/ubuntu-12.04.2-desktop-amd64.iso"
        # if you use a single partition for your $HOME
        loopback loop (hd0,5)$isofile
        linux (loop)/casper/vmlinuz.efi boot=casper iso-scan/filename=$isofile noprompt noeject
        initrd (loop)/casper/initrd.lz
}
Menuentry Details

The menuentry constructed above is built with the following considerations.

menuentry
The menuentry title (between the quotations) is determined by the user. Any title can be used. The line
must end with {

set isofile
Designating an 'isofile' variable is not required but simplifies the creation of multiple Ubuntu ISO
menuentries. By using this convention, the user can copy an existing ISO menuentry and, if the ISO
is located in the same folder, simply change the menuentry title and the name of the ISO file on this
line. No other changes are necessary.
The set isofile line should reflect the exact name of the ISO file

loopback
The loopback line must reflect the actual location of the ISO file. In the example, the ISO file is
stored in the user's Downloads folder.

X is the drive number, starting with 0; Y is the partition number, starting with 1
sda5 would be designated as (hd0,5); sdb1 would be (hd1,1)
Other Location Examples:
(hd0,5)/boot/$isofile

Located in the system's normal /boot partition on sda5

(hd0,6)/$isofile

Located in a separate boot partition on sda6

(hd0,7)/username/Downloads/$isofile

Located in a separate home partition on sda7

(hd1,2)/iso/$isofile

Located in the /iso folder of the sdb2 data partition

linux
This line is specific to the Ubuntu family of ISOs. Other Linux distributions and system ISOs may use
different filenames, folders and switches to boot their ISOs. Check the Grub2/ISOBoot/Examples page
to see if an example exists. The user can also mount the ISO and explore its contents to ensure the
menuentry contains the correct filenames and paths.

initrd
See the linux line notes. Additionally, some other systems use initrd.gz rather than initrd.lz on their ISOs.

important.png If the ISO is stored on a partition formatted differently than your main operating system,
it may be necessary to load the module for the specific format before GRUB can access it. In this case,
add the following line immediately after the menuentry line for the desired format (ntfs, reiserfs,
etc). It should not be necessary, but if GRUB cannot read the ISO the iso9660 module can also be loaded:

insmod ntfs

insmod iso9660

For more information on creating a custom menuentry, please visit Grub2/CustomMenus.

Booting the ISO
Once the menuentry has been created and GRUB 2 updated, the ISO entry will appear on the GRUB menu during
boot. If the entry was created in the /etc/grub.d/40_custom file, it will appear after the Ubuntu and
other OS listings on the main GRUB menu.

To boot the ISO, highlight the entry and press ENTER or F10.

If the menuentry was created using grml-rescueboot, once the ISO is selected from the menuentry additional
options such as "Try Me" or "Install" will be presented before booting.

Booting without a GRUB Menuentry
Although GRUB 2 must be installed and working, it is not required to have a menuentry in order to boot
the ISO. Booting can be accomplished from the GRUB prompt by manually typing in each command in the
menuentry example (except the menuentry title line).

To access the GRUB prompt, type 'c' while the GRUB menu is displayed.
Manually type each line (except the menuentry line) and press ENTER.

If no messages are displayed after pressing ENTER the command ran successfully.
After entering the final line, type boot and ENTER.

You can return to the main menu at any time by pressing ESC.
Booting via this method is not persistent. The commands need to be entered on each subsequent boot until
a menuentry is created in the GRUB menu.

Menuentry Troubleshooting
There are a variety of reasons why a menuentry may fail to boot the ISO. Since the Ubuntu ISOs are
standardized, the most likely reason is an incorrect path in one of the menuentry lines. Another likely
problem is mistyping the ISO filename - for instance using a - rather than a _ or using the wrong
version number.

The following steps may help identify the problem:

Verify the filename is typed correctly.
Ensure the proper path is used.
At the Grub prompt, the user can explore both the partitions and the ISO file itself.
Type "ls (hdX,Y)/" or "ls (hdX,Y)/<path>" to inspect the contents of a partition or folder.

Mount the ISO using the "loopback loop" entry and then explore the contents using "ls (loop)/".
Alternatively, you can explore the ISO contents from a running system via the methods detailed in the
Exploring_the_ISO_Contents section of this guide.

Do not use 'curly quotes' or leave extra spaces in the entries.
Try typing the menuentry (except the title line) manually at the Grub prompt and watch for error messages
which may help pinpoint the problem.

If the ISO begins to boot but crashes or halts midway through the boot, the initrd image may not be
found or one of the linux line kernel options may be incorrect.

For non-Ubuntu entries the switches on the linux line can be quite complicated. If there is no available
example, search forums or the application's web site for working examples.

Installing Ubuntu from a Menuentry Boot
Installation onto your hard drive is possible from a booted ISO file. A CD/DVD is not required. An
Internet connection is recommended but not required. Without a connection packages installed from the
ISO will not be updated and additional packages which may be necessary, such as video drivers, can not
be downloaded. An Internet connection should be available after booting the ISO file from the GRUB menu.

To Install Ubuntu from an ISO Menuentry, use the procedures previously discussed to:

Download the appropriate ISO.
Move it to the desired location.
Create the GRUB 2 menuentry and update the GRUB configuration file.
Boot the ISO from the GRUB menu.
Note: If you have a large amount of RAM you may be able to use the toram option. This will allow the
system to boot into memory and permit automatic unmounting of the isodevice during the installation. If
you would like to try this option:

Press 'e' to edit the menuentry and add toram to the end of the menuentry's linux line:

linux /casper/vmlinuz boot=casper iso-scan/filename=/<ISO-name.iso> noprompt noeject toram --

If /isodevice can be unmounted by the installer at the prompt, the installation will continue.
If you have insufficient memory and start the installation, the installer will be unable to unmount
/isodevice, the install will fail and the system may freeze.
Since edits to the menuentry are not persistent, if the toram option fails, simply reboot and use the
existing menuentry without editing it.

Once booted to the Ubuntu LiveCD desktop:

The /isodevice must be unmounted for a successful installation. If /isodevice cannot be unmounted by
the installer, the installation will fail unless the user forces its unmounting.

If the toram option was not used or was unsuccessful, unmount /isodevice:

Open a terminal and run the following command:
sudo umount -l -r -f /isodevice
Start the installation procedure by double-clicking the "Install Ubuntu" icon.
Example ISO Menuentries
GRUB 2 can boot the ISOs of many Linux operating systems and rescue CDs if they were built with this
capability. The filenames, locations and kernel options vary widely and it can be difficult to determine
the exact commands necessary to boot these ISOs.

An Examples page has been created to allow Ubuntu contributors to provide known, working menuentries
for the ISOs of popular Linux and utility discs.

If an example of a desired ISO is not listed, the user may be able to determine the proper menuentry
commands by comparing the file structure of the ISO with the menuentry commands of ISOs laid out in a
similar fashion. Mounting the ISO as detailed in the Exploring_the_ISO_Contents section of this guide
may help determine the proper entries.

Additionally, the user can search the Internet for menuentry examples or seek advice in forums specializing
in the specific OS or utility.

Alternatives to ISO Booting
In addition to booting directly from an ISO menuentry or a bootable CD/DVD, there are also applications
which can install the contents of an ISO onto the user's hard drive. These utilities copy the necessary
system files into a folder on the partition designated by the user and can create a menuentry to access
these files.

One such utility compatible with Ubuntu is UNetbootin. UNetbootin is available via the Ubuntu repositories
and Launchpad. Once UNetbootin extracts/installs the ISO files of an operating system or utility it
generates a new item in the GRUB 2 menu.



---
http://ubuntuforums.org/showthread.php?t=2276498
pg 1/2

Thread: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images

Cool How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
For this Tutorial, there are some Assumptions:

You can format your usb drive (did you do a backup?)
Your USB drive is the /dev/sdb device (You can check yours with sudo fdisk -l or using Gparted)
Your USB drive will be mounted at /mnt
You are using a Ubuntu distro (any Ubuntu flavour) - Could be a live session (LiveCD)
You are logged with the first user (setted at installation or live session default)
You are not afraid of Linux Command Interface

First Step: Format USB drive

To create a EFI firmware compatible boot drive, you need a GPT partition table and at least one FAT32
partition. Do as follows...

sudo apt-get install gdisk
sudo sgdisk --zap-all /dev/sdb
You probably need to remove and insert the USB drive again at this point for the kernel to update
information about it...
sudo sgdisk --new=1:0:0 --typecode=1:ef00 /dev/sdb
sudo mkfs.vfat -F32 -n GRUB2EFI /dev/sdb1

We are done with Step One, you can check modifications with sudo parted -l or with Gparted.

Second Step: Copy files and Set directory structure
Let's mount the usb drive...
sudo mount -t vfat /dev/sdb1 /mnt -o uid=1000,gid=1000,umask=022

To make life easier, I created a pack with all necessary files for you to modify as you need. If
you don't trust my files, create yours using this page as reference. Link to Download is:
http://webativo.com/uploads/files/usb-pack_efi.zip

Extract the zip file and paste those inner files using Command Line Interface or a file manager you like.
cd ~/Downloads/
unzip usb-pack_efi.zip
rsync -auv usb-pack_efi/ /mnt

The most important files are bootia32.efi to boot on 32bit machines, bootx64.efi to boot on 64bit machines
and grub.cfg to setup grub to load ISOs or chainload to other paths.

In the end, you might get a directory tree like this:
<pic>

Third Step: Install GRUB2 on the drive
sudo grub-install --removable --boot-directory=/mnt/boot --efi-directory=/mnt/EFI/BOOT /dev/sdb
PS: Grub2 installation might throw some error messages, just ignore it.
PS: If you have problems to copy and paste content on /mnt, you can use sudo to do it

Fourth Step: Setup ISOs to be loaded
Put (copy) the .iso files you want to load in /mnt/iso/ and setup grub.cfg like the existing examples...

Note that the most important variable to set is isofile. There is lots of examples on the web about how
to configure grub2 menu. Use # to comment those lines you don't want to use, e.g. to hide a configuration
of absent .iso at /iso.

Last Step: Configure firmware and Test
First and most important, deactivate secure boot on your computer's firmware. Search on the web if you
don't know how.

To boot the USB drive you can set your machine firmware to search first for the USB device (boot order). Or
you can choose what drive to boot as soon as you turn on your computer. Each manufacturer has its own
keys to do it. Search for your machine's manual if needed.
Last edited by sysmatck; June 10th, 2015 at 11:38 PM. Reason: correction...

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
I tested your multiboot system in my Toshiba laptop, my only computer with UEFI.

http://www.toshiba.se/laptops/satell...-pro-c850-19w/

It works well in UEFI mode

Comments and tips:
1. If the user has two other mass storage devices connected, there is a risk that valuable data on
/dev/sdb

will be overwritten. Maybe the template should have
/dev/sdx

instead, and the user should change x to what it should be.

2. The grub-install command lacks a space between the boot directory and the device, should be
sudo grub-install --removable --boot-directory=/mnt/boot --efi-directory=/mnt/EFI/BOOT /dev/sdb

3. Maybe it would help to suggest an rsync command to copy the content of the zipfile to the pendrive,
for example
extract files:
unzip usb-pack_efi

copy files:
sudo rsync -Havn usb-pack_efi/ /mnt
or an advanced unzip command line to do it directly.


4. I modified grub.cfg and could boot from the following iso files
kubuntu-14.04.1-desktop-amd64.iso
ubuntu-14.04.2-desktop-amd64.iso
xubuntu-14.04.1-desktop-i386.iso

Notice that I could also boot the 32-bit Xubuntu system in UEFI mode.

5. But I could only boot in UEFI mode, not in BIOS mode alias CSM.
I did not even get to the grub menu in BIOS mode. Did I miss something? Have you managed to boot in BIOS
mode with this system? Or is it an UEFI-only system?

6. My computer has problems with the graphics when UEFI mode and rescue mode, I think it is because of
nomodeset and I do not blame your multiboot system for it. I tried with and without gfxpayload without
success.

7. My modified grub.cfg:

submenu "Boot em HD " {
    #menuentry "Reboot em USB" {
    #    set root="(hd0)"
    #    chainloader +1
    #}
    menuentry "HD1 MBR" {
        set root="(hd1)"
        chainloader +1
    }
    menuentry "HD1 Particao 1" {
        set root="(hd1,msdos1)"
        chainloader +1
    }
    menuentry "HD1 Particao 2" {
        set root="(hd1,msdos2)"
        chainloader +1
    }
    menuentry "HD1 Particao 3" {
        set root="(hd1,msdos3)"
        chainloader +1
    }
    menuentry "HD2 MBR" {
        set root="(hd2)"
        chainloader +1
    }
    menuentry "HD2 Particao 1" {
        set root="(hd2,msdos1)"
        chainloader +1
    }
    menuentry "HD2 Particao 2" {
        set root="(hd2,msdos2)"
        chainloader +1
    }
    menuentry "HD2 Particao 3" {
        set root="(hd2,msdos3)"
        chainloader +1
    }
}

menuentry "Grub4dos - HBCD+"{
    # mudar (hd0,2) ou outros para diferentes computadores...

    setroot=(hd0,1)
    linux /boot/grub4dos/grub.exe
}

submenu "Teste de Memoria" {
    menuentry "memtest86+ 4.20" {
        linux16 /boot/memtest/memtest.bin
    }
    menuentry "memtest86+-5.01" {
        linux16 /boot/memtest/memtest86+-5.01.bin
    }
}


menuentry 'Kubuntu 14.04.1 amd64' {
    set isofile="/iso/kubuntu-14.04.1-desktop-amd64.iso"
    loopback loop $isofile
    linux (loop)/casper/vmlinuz.efi boot=casper iso-scan/filename=$isofile liveimg noprompt noeject
    quiet splash --
    initrd (loop)/casper/initrd.lz
}

submenu "submenu Kubuntu 14.04.1" {
    menuentry 'Kubuntu 14.04.1 amd64 (failsafe)' {
        set isofile="/iso/kubuntu-14.04.1-desktop-amd64.iso"
        loopback loop $isofile
#        set gfxpayload=800x600x16,800x600
        linux (loop)/casper/vmlinuz.efi boot=casper iso-scan/filename=$isofile liveimg noeject nomodeset
        noapic --
        initrd (loop)/casper/initrd.lz
    }
}
menuentry 'Ubuntu 14.04.2 amd64' {
    set isofile="/iso/ubuntu-14.04.2-desktop-amd64.iso"
    loopback loop $isofile
    linux (loop)/casper/vmlinuz.efi boot=casper iso-scan/filename=$isofile liveimg noprompt noeject
    quiet splash --
    initrd (loop)/casper/initrd.lz
}

submenu "submenu Ubuntu 14.04.2" {
    menuentry 'Ubuntu 14.04.2 amd64 (failsafe)' {
        set isofile="/iso/ubuntu-14.04.2-desktop-amd64.iso"
        loopback loop $isofile
#        set gfxpayload=800x600x16,800x600
        linux (loop)/casper/vmlinuz.efi boot=casper iso-scan/filename=$isofile liveimg noeject nomodeset
        noapic --
        initrd (loop)/casper/initrd.lz
    }
}

menuentry "Xubuntu 14.04.1 i386" {
        set isofile="/iso/xubuntu-14.04.1-desktop-i386.iso"
    loopback loop $isofile
    linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile liveimg noprompt noeject quiet
    splash --
    initrd (loop)/casper/initrd.lz
}

submenu "submenu Xubuntu 14.04.1 i386" {
    menuentry 'Xubuntu 14.04.1 i386 (failsafe)' {
        set isofile="/iso/xubuntu-14.04.1-desktop-i386.iso"
        loopback loop $isofile
#        set gfxpayload=800x600x16,800x600
        linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile liveimg noeject nomodeset
        noapic --
        initrd (loop)/casper/initrd.lz
    }
}


***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
Thankyou for testing sudodus! I'm glad it works for you (with needed ajustments)

1- I wrote an introduction for for this tutorial, I called it Assumption #2, where I observe this path
issue. I prefer people to understand what they are doing, and sometimes is hard to figure exactly what
users must type to get things done...

2- I just edited the post, and I corrected the command inserting the lacking space. I edited this post
couple times, I suppose I removed accidentally on one of them...

3- Yes, I guess suggesting this commands is better (for the sake of completion), I'm glad you did it. I
did not do it because I usually extract using GUI.

4- Nice! And good that you are also sharing the grub.cfg for others to use!

5- This is UEFI only system. But I guess it is possible to do a GRUB2 for both on a single drive. I
also use something very similar to boot CSM using ext4 partitions. The downside of this (EFI) is that
we must use a FAT32 partition to boot, so, if using a single FAT32 on a 32gb drive (just an example),
you will be limited to 4gb max file size... I guess using two partitions will be a much more interesting
solution for this "dual mode" boot device...

6- Hum... Research needed. There might have a kernel parameter that solves your problem...

Tnx! I will reply to this thread if I have some news or better ways to create this boot device (maybe on
"dual mode"...)

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
I noticed and reviewed your steps but have not tried it.
I have UEFI install and just copied folders from my /EFI/Boot & /EFI/ubuntu onto flash drive.

With ISO I use grub2's loopmount, but invariable change to a newer ISO or add an ISO and forget to run
sudo update-grub or edit grub.cfg.

I now use a configfile to call a text file in my ISO folder.
insmod part_gpt
insmod fat
set root='hd0,msdos1'

menuentry 'Live ISOs' {
configfile (hd0,1)/iso/livecdimage.cfg
}

Then the livecdimage.cfg is just another boot stanza, but can be edited at will without updating grub.
# livecdimage.cfg
# Add this to 40_custom to load this file:
# menuentry 'Live ISOs' {
# configfile (hd2,4)/iso/livecdimage.cfg
#}
# Add iso names to livecdimage.cfg
#for i in `ls *.iso`;do echo "# "$i>>livecdimage.cfg; done;


menuentry "gparted (Boot ISO Image via Grub2) " {
    insmod part_gpt
    set isofile="/iso/gparted-live-0.19.1-1-amd64.iso"
    loopback loop (hd0,1)$isofile
    linux (loop)/live/vmlinuz boot=live config union=aufs noswap noprompt ip=frommedia findiso=$isofile
    toram=filesystem.squashfs
    initrd (loop)/live/initrd.img
}

menuentry "Mini Ubuntu-14.04.1-desktop" {
    set isofile="/iso/mini.iso"
    insmod part_gpt
    loopback loop (hd0,1)$isofile
    linux (loop)/vmlinux boot=casper iso-scan/filename=$isofile nomodeset
    initrd (loop)/initrd.gz
}


For more info on UEFI boot install & repair - Updated Oct 2015:
http://ubuntuforums.org/showthread.php?t=2147295
Please use Thread Tools above first post to change to [Solved] when/if answered completely.

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
A USB multiboot pendrive that boots in UEFI and BIOS mode,
and that boots 32-bit and 64-bit operating systems.

I continued tweaking the USB pendrive according to post #2.

0. Perform the tasks in post #1 and #2 in UEFI mode
I performed the tasks in post #1 and #2 in UEFI mode.

1. Boot another Ubuntu 14.04.2 LTS desktop (64-bit) system into BIOS mode
Now I switched my computer (Toshiba laptop) to CSM alias BIOS mode and booted into a pendrive with Ubuntu
14.04.2 LTS desktop (64-bit). Boot another system, not the target pendrive.

2. Install grub in BIOS mode
I ran the following commands to install grub in BIOS mode. It complained but worked when forced, and did
not overwrite the boot system for UEFI mode. Check carefully the device id for your multiboot pendrive,
so that you do not overwrite any valuable data!
sudo lsblk -fm
sudo mount /dev/sdx1 /mnt
sudo grub-install --force --removable --boot-directory=/mnt/boot /dev/sdx

In my case x was b, so I could use
sudo mount /dev/sdb1 /mnt
sudo grub-install --force --removable --boot-directory=/mnt/boot /dev/sdb

3. Enjoy the result
That's all. These simple operations managed to make the multiboot pendrive boot in both UEFI and BIOS
mode. So now it is possible to use this pendrive to boot 'any computer' from an old 32-bit computer
(in BIOS mode) to a new computer in BIOS mode as well as in UEFI mode. (But if the manufacturer has
tweaked the UEFI system beyond the standard for UEFI, it might be hard to boot anything except Windows.)

I tested and can run Xubuntu (xubuntu-14.04.1-desktop-i386.iso) in these computers

http://www.toshiba.se/laptops/satell...-pro-c850-19w/, Intel i5, 64-bit: UEFI and BIOS, bought 2013
http://www.asus.com/Motherboards/M2NVM_DVI/, AMD Athlon 64 X2, 64-bit: BIOS, bought 2008
http://support.dell.com/support/edoc...i/sm/specs.htm, Pentium 4, 32-bit: BIOS, bought 2004

We know since before how to make it boot in UEFI mode. The following commands and output from the
commands were run in a Dell Dimension 4600 with a Pentium 4 processor, which is a 32-bit system, that
runs in BIOS mode.

xubuntu@xubuntu:~$ sudo lshw -class cpu
  *-cpu
       description: CPU
       product: Intel(R) Pentium(R) 4 CPU 2.80GHz
       vendor: Intel Corp.
       physical id: 400
       bus info: cpu@0
       version: 15.2.9
       slot: Microprocessor
       size: 2800MHz
       capacity: 3200MHz
       width: 32 bits
       clock: 533MHz
       capabilities: boot fpu fpu_exception wp vme de pse tsc msr pae mce cx8 apic sep mtrr pge mca cmov
       pat pse36 clflush dts acpi mmx fxsr sse sse2 ss ht tm pbe pebs bts cid xtpr
       configuration: id=0
xubuntu@xubuntu:~$ uname -a
Linux xubuntu 3.13.0-32-generic #57-Ubuntu SMP Tue Jul 15 03:51:12 UTC 2014 i686 i686 i686 GNU/Linux
xubuntu@xubuntu:~$ lsb_release -a
No LSB modules are available.
Distributor ID:    Ubuntu
Description:    Ubuntu 14.04.1 LTS
Release:    14.04
Codename:    trusty
xubuntu@xubuntu:~$ sudo lsblk -fm
NAME   FSTYPE   LABEL                    MOUNTPOINT NAME     SIZE OWNER GROUP MODE
sda                                                 sda    111.8G root  disk  brw-rw----
+存da1                                              +存da1     1K root  disk  brw-rw----
+存da2 ntfs     winxp                               +存da2  79.8G root  disk  brw-rw----
+存da5 swap                              [SWAP]     +存da5     4G root  disk  brw-rw----
L存da6 ext4     ToriOS-i386                         L存da6    28G root  disk  brw-rw----
sdb                                                 sdb    111.8G root  disk  brw-rw----
L存db1 ntfs     Backup                              L存db1 111.8G root  disk  brw-rw----
sdc                                                 sdc     14.6G root  disk  brw-rw----
L存dc1 vfat     GRUB2EFI                 /isodevice L存dc1  14.6G root  disk  brw-rw----
sr0                                                 sr0     1024M root  cdrom brw-rw----
sr1                                                 sr1     1024M root  cdrom brw-rw----
loop0  iso9660  Xubuntu 14.04.1 LTS i386 /cdrom     loop0    916M root  disk  brw-rw----
loop1  squashfs                          /rofs      loop1  883.8M root  disk  brw-rw----
xubuntu@xubuntu:~$ ls -l /isodevice/*
/isodevice/boot:
total 24
drwxr-xr-x 5 root root 8192 May 22 11:16 grub
drwxr-xr-x 2 root root 8192 May  2 17:46 grub4dos
drwxr-xr-x 2 root root 8192 May  2 17:46 memtest

/isodevice/EFI:
total 8
drwxr-xr-x 2 root root 8192 May  2 17:48 BOOT

/isodevice/iso:
total 3011408
-rwxr-xr-x 1 root root 1078804480 May 22 10:35 kubuntu-14.04.1-desktop-amd64.iso
-rwxr-xr-x 1 root root 1044381696 May 22 10:34 ubuntu-14.04.2-desktop-amd64.iso
-rwxr-xr-x 1 root root  960495616 May 22 10:35 xubuntu-14.04.1-desktop-i386.iso
xubuntu@xubuntu:~$ df
Filesystem     1K-blocks    Used Available Use% Mounted on
/cow              772216   98480    673736  13% /
udev              761528       4    761524   1% /dev
tmpfs             154444    1068    153376   1% /run
/dev/sdc1       15309832 3019472  12290360  20% /isodevice
/dev/loop0        937984  937984         0 100% /cdrom
/dev/loop1        905088  905088         0 100% /rofs
none                   4       0         4   0% /sys/fs/cgroup
tmpfs             772216       8    772208   1% /tmp
none                5120       0      5120   0% /run/lock
none              772216      80    772136   1% /run/shm
none              102400      24    102376   1% /run/user
xubuntu@xubuntu:~$ find /isodevice/ -ls|grep -v /isodevice/boot/grub/i386-pc/
     1    8 drwxr-xr-x   5 root     root         8192 Jan  1  1970 /isodevice/
     7    8 drwxr-xr-x   5 root     root         8192 May  2 17:46 /isodevice/boot
    12    8 drwxr-xr-x   5 root     root         8192 May 22 11:16 /isodevice/boot/grub
    28   24 drwxr-xr-x   2 root     root        24576 Jun  7 05:13 /isodevice/boot/grub/i386-pc
   300    8 drwxr-xr-x   2 root     root         8192 Jun  7 05:13 /isodevice/boot/grub/locale
  1439    8 -rwxr-xr-x   1 root     root         1032 Jun  7 05:13 /isodevice/boot/grub/locale/en_AU.mo
  1440    8 -rwxr-xr-x   1 root     root          587 Jun  7 05:13 /isodevice/boot/grub/locale/en_CA.mo
  1441    8 -rwxr-xr-x   1 root     root         4464 Jun  7 05:13 /isodevice/boot/grub/locale/en_GB.mo
  1442  128 -rwxr-xr-x   1 root     root       130811 Jun  7 05:13 /isodevice/boot/grub/locale/es.mo
  1443   32 -rwxr-xr-x   1 root     root        31315 Jun  7 05:13 /isodevice/boot/grub/locale/zh_CN.mo
   306    8 drwxr-xr-x   2 root     root         8192 May 22 10:27 /isodevice/boot/grub/fonts
  1445 2352 -rwxr-xr-x   1 root     root      2405285 Jun  7 05:13 /isodevice/boot/grub/fonts/unicode.pf2
  1446    8 -rwxr-xr-x   1 root     root         2827 May 22 11:24 /isodevice/boot/grub/grub.cfg
  1447    8 -rwxr-xr-x   1 root     root         1024 May 22 10:27 /isodevice/boot/grub/grubenv
  1448    8 -rwxr-xr-x   1 root     root         2125 Jan  6 16:10 /isodevice/boot/grub/menu.lst
  1449    8 -rwxr-xr-x   1 root     root         3894 May 22 11:10 /isodevice/boot/grub/grub.cfg~
    13    8 drwxr-xr-x   2 root     root         8192 May  2 17:46 /isodevice/boot/grub4dos
  1452  232 -rwxr-xr-x   1 root     root       234697 Mar 31  2009 /isodevice/boot/grub4dos/grub.exe
  1453  216 -rwxr-xr-x   1 root     root       217769 Mar 31  2009 /isodevice/boot/grub4dos/g2ldr
    14    8 drwxr-xr-x   2 root     root         8192 May  2 17:46 /isodevice/boot/memtest
  1456  152 -rwxr-xr-x   1 root     root       150024 Aug 23  2013
  /isodevice/boot/memtest/memtest86+-5.01.bin
  1457  168 -rwxr-xr-x   1 root     root       164504 Jan 23  2011 /isodevice/boot/memtest/memtest.bin
     8    8 drwxr-xr-x   3 root     root         8192 May  2 17:48 /isodevice/EFI
    16    8 drwxr-xr-x   2 root     root         8192 May  2 17:48 /isodevice/EFI/BOOT
  1460  608 -rwxr-xr-x   1 root     root       621056 Apr 28 13:51 /isodevice/EFI/BOOT/bootia32.efi
  1461  904 -rwxr-xr-x   1 root     root       920064 Apr 29 20:38 /isodevice/EFI/BOOT/bootx64.efi
     3    8 drwxr-xr-x   2 root     root         8192 May 22 10:38 /isodevice/iso
    19 1053520 -rwxr-xr-x   1 root     root     1078804480 May 22 10:35
    /isodevice/iso/kubuntu-14.04.1-desktop-amd64.iso
    20 1019904 -rwxr-xr-x   1 root     root     1044381696 May 22 10:34
    /isodevice/iso/ubuntu-14.04.2-desktop-amd64.iso
     4 937984 -rwxr-xr-x   1 root     root     960495616 May 22 10:35
     /isodevice/iso/xubuntu-14.04.1-desktop-i386.iso
I think that /isodevice/EFI/BOOT/bootia32.efi makes it possible to boot 32-bit systems while
/isodevice/EFI/BOOT/bootx64.efi makes it possible to boot 64-bit systems (in UEFI mode). Please correct
me if I am wrong.

4. Welcome to test this multiboot system
We need long time testing by several users to find out if this system is stable, that it continues
working in the long run.

Follow the instructions in this thread if you want to learn how to make a single boot or multiboot system
for UEFI & BIOS, 32-bit & 64 bit systems. But if you want to make such a pendrive quickly, with Lubuntu
14.04.2 desktop 32-bit ISO file, you can get a compressed image file and install it according to the
following link,

A smaller and simpler pendrive for all PC (Intel/AMD) computers - 'grub-n-iso'
Last edited by sudodus; June 9th, 2015 at 02:21 AM.
Advanced reply Adv Reply    Reply With Quote Reply With Quote
June 10th, 2015 #6 sysmatck  sysmatck is offline
5 Cups of Ubuntu

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
The additional grub2 possible parameters are: --target=i386-pc or --target=x86_64-efi

I will try this again later. Let me test the drive as it is on old hardware first...

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
As far as I can tell, this provides a simple method to create 'One pendrive for all computers', a truly
portable pendrive, and with persistence you can carry your computer environment (added software, tweaks
and personal files) in your pocket

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
Ok, I just tested on some other machines... Works like a charm!

BIOS Motherboards:
ASRock G31M-VS
MSI G31M3-V2
Asus P6KPL-AM
Foxconn M61PMV
ASRock 980DE3/U3S3

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
I made the USB boot drive and tested it in my Toshiba with UEFI and BIOS. I tested it in my daughter's
HP ProBook 6450b (also with UEFI and BIOS)

http://h20564.www2.hp.com/hpsc/doc/p...r_na-c02218879

And I tested it in older computers with only BIOS, even an old Dell with Pentium 4 (32-bit). The same
pendrive with a Lubuntu 32-bit iso file works in all the computers and modes (BIOS and UEFI) where I
have tested it.

- There is a hardware limit. The computer may be too weak to boot a current version of Lubuntu, or there
is some hardware, for example graphics chip, where the available drivers do not work. But then it is
possible to include iso files for other linux distros. See the following list that describes how to
configure grub for several distros

https://wiki.archlinux.org/index.php...boot_USB_drive

- Another limit is where the system is so locked down by a non-standard UEFI system, that nothing but
Windows works.


---
http://ubuntuforums.org/showthread.php?t=2276498&page=2
pg 2/2

Thread: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
Build your own single boot or multiboot pendrive for all PC (Intel/AMD) computers

I made a system, where a shell-script helps performing the operations, that are described in this thread. I
found that it is possible to do everything in either UEFI mode or BIOS mode, the two grub installations
are simply done with two different command lines.

$ grep grub-install mk-grub-n-iso
grub-install --force --removable --no-floppy --boot-directory=/mnt/target/boot
--efi-directory=/mnt/target/EFI/BOOT "$2"
grub-install --force --removable --no-floppy --boot-directory=/mnt/target/boot "$2"

This works in an Ubuntu family operating system of version 14.04 LTS or newer. (It is possible to use
Ubuntu 12.04 LTS too, but it has an older version of grub, and I have not found a method to make pendrives
that boot in both UEFI and BIOS mode.)

This link describes how to install and use this system,

Build your own single boot or multiboot pendrive for all PC (Intel/AMD) computers

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
The EFI partition must have a FAT file system. Linux works best with linux file systems but Windows
cannot mount partitions with linux file systems. So in order for Windows to mount them, you need FAT
or NTFS file systems. If you want access the ISO files from both linux and Windows, I would recommend
using the FAT32 file system (for the partition where you keep the ISO files).

Yes, you can create a second (or third etc) partition if you wish, but avoid storing the ISO files in
two places.

Edit: There is one thing I should add - At least some versions of Windows have problems to mount more
than one partition on USB drives. (I don't know if it affects all versions of Windows.) It wants to
open the first one, but I am not sure what happens if the first partition is recognized as an EFI
partition. I just checked: Windows 7 will only recognize the first partition (the EFI partition). Some
other Windows version might mount the second partition, if it has a Windows file system. But to be sure,
make a big first partition with the FAT32 file system, and keep the ISO files there, if you want them
to be available from Windows.

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
Quote Originally Posted by Starbeamrainbowlab  View Post
Update:

By changing the partition to "0700" (A basic data partition) I can boot using UEFI + BIOS, but I can
also see it in Windows.
Yes, I did some testing. I can also boot using 0700 as partition type. When using 1:ef00 the partition
will not automount on Linux. But with 0700 it is mounted automatically. I supose this is an interesting
information, if you want a partition to automount, maybe 0700 is a better option. If this will be just
a boot partition, you might prefer not to mount...

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
Hello Again!

I just wanted to report that I'm being able to boot with UEFI/BIOS mode with a dual partition USB stick. The
first partition is EF00 and the second one EXT4(8300). The boot and EFI directories were stored on the
first partition e.g. /dev/sdb1 and the iso directory is located on EXT4 partition e.g. /dev/sdb2

I can boot with GRUB2 using the following code

menuentry 'Lubuntu 14.04 i386' {
		set isofile="/iso/lubuntu-14.04.2-desktop-i386.iso"
		loopback loop (hd0,2)$isofile
		linux (loop)/casper/vmlinuz boot=casper iso-scan/filename=$isofile liveimg noprompt
		noeject quiet splash --
		initrd (loop)/casper/initrd.lz
	}
	
Note the difference on "Loopback" line... This is it!

***
Re: How to Create a EFI/UEFI GRUB2 Multiboot USB drive to boot ISO images
Yes, it works

I've done something similar as described in post #11 (and the link from there)

and also at the following link: mkusb/persistent



---
http://askubuntu.com/questions/423300/live-usb-on-a-2-partition-usb-drive

Live USB on a 2-partition usb-drive
I was wondering if I could have 2 partitions on a USB-drive that would allow me to boot on my key as a
regular USB-installation-disk (partition1), and another partition for regular storage under Windows/Ubuntu
(partition2). I would like to have a disk with :

/dev/sdb (16GB)
 - sdb1 : ext4/fat32, LiveUSB (2GB)
 - sdb2 : fat32, storage (14GB)
Could that key be booted AND used as a regular USB drive ?

PS: that is because I'm sick of installing/uninstalling Ubuntu on my USB drive everytime I need to rescue
a PC, and I'm not willing to buy a USB-drive only for Ubuntu-installation-disk.

***
Yes, you can partition a USB flash drive to boot into a Ubuntu Live Session and use it as a regular USB
drive (accessable to windows) on separate partitions. I was able to do this with a 32GB PNY USB 2.0 flash
drive on a Sony Vaio T Series Ultrabook laptop with UEFI and Windows 8.0 installed. I also tested this
from Ubuntu server 12.04 on my 16TB RAID5 i7-290 server.

I partitioned the USB flash drive using GParted in this configuration:

32GB USB Flash Drive GParted
+-+---------------------------+------------+------------+------------------+
| |	   /dev/sdh1	      | /dev/sdh2  | /dev/sdh3	|    unallocated   |
| |	   10.00GiB	      |  5.00GiB   |  5.00GiB	|    9.93GiB	   |
+-+---------------------------+------------+------------+------------------+

----------------------------------------------------------------	------------
Partition	File system	Mount Point		Size		Flags
----------------------------------------------------------------	------------
unallocated	unallocated	-			25.00MiB	-
/dev/sdh1	ntfs		/media/storage		10.00GiB	-
/dev/sdh2	fat32		/media/UbuntuD1204	 5.00GiB	boot
/dev/sdh3	fat32		/media/hirens		 5.00GiB	-
/dev/sdh4	extended	-			 9.93GiB	-
unallocated	unallocated	-			 9.93GiB	-
----------------------------------------------------------------	------------

sdh1 is the "Storage" partition that's accessible from Windows.  sdh2 is the Ubuntu desktop 12.04
boot-able partition. These were my steps:

 1. Created a new 10 GB, ntfs, logical partition, with 25 MB Free space preceding
    and 0 MB following, labeled Storage (must be first on the drive)
 2. Created a new 5 GB, fat32, logical partition, with 0 MB preceding and following
 3. Set a boot flag for the second partition
 4. (Created the other partitions which are not needed)
 5. Booted to a Ubuntu Live Session loaded on a DVD and selected Try Ubuntu
    without installing from the GRUB menu
 6. Opened Startup Disk Creator with the USB flash drive pluged-in
 7. The Ubuntu-Desktop 12.04 Image and pny USB 2.0 flash drive (/dev/sdh2) 5.0 GB
    partition were already selected, moved the How much slide to store documents
    and settings in reserved extra space and selected Make Startup Disk
    
Without selecting the boot flag, the Startup Disk Creator would only recognize the entire flash drive
as /dev/sdh, instead of the desired second partition /dev/sdh2.

Without putting the Windows partition first, the Removable Media Bit...

"The removable media device setting is a flag contained within the SCSI Inquiry Data
response to the SCSI Inquiry command. Bit 7 of byte 1 (indexed from 0) is the
Removable Media Bit (RMB). An RMB set to zero indicates that the device is not a
removable media device. An RMB of one indicates that the device is a removable
media device. Drivers obtain this information by using the StorageDeviceProperty
request."
...would mean only 1 partition shows up in Windows:

"Q. What is a superfloppy?

A.
Removable media without either GPT or MBR formatting is considered a "superfloppy."
The entire media is treated as a single partition.

The media manufacturer performs any MBR partitioning of removable media. If the
media does have an MBR, only one partition is supported. There is little
user-discernible difference between MBR-partitioned media and superfloppies.

Examples of removable media include floppy disk drives, JAZ disk cartridges,
magneto-optical media, DVD-ROM, and CD-ROM. Hard disk drives on external buses
such as SCSI or IEEE 1394 are not considered removable."
Here are some tools that flip the RMB (which is unnecessary in this case):
Laxar's USB Format Tool
Bootice
RMPrepUSB

These are software approaches (again unnecessary in this case):
Create a dummy.sys Driver
Use the Hitachi Microdrive Filterdriver

Credit:
TSJNachos117 Live USB on a 2-partition usb-drive
http://ubuntuforums.org/showthread.php?t=1020293
http://stackoverflow.com/questions/2598502/howto-flip-removable-bit-on-usb-drive-in-c
http://www.rmprepusb.com/tutorials/multipartufd

***
Thanks, I'll try that. I know I could use a folder inside the same partition, but that is NOT graceful. I
want a nice thing, it's in my everyday life and I want some class :) // Not to brag but I also know how

It does; I just verified to be sure. I like your idea though and am expanding upon it to create 3 partitions:
Ubuntu12.04 (bootable), Hirens (bootable), and Storage. I'd like to be classy like that too ;)

***
Got it to work much easier than anything I found online...finally.

Is there a reason for the 25 MB preceding the partitions? Why 25? Does the size differ based on the
total space of the flash drive?

***
That's not really what I want to do, the reason I want to separate partitions is to have a clean storage
space, without all the folders from the ubuntu installation disk. Just having them hidden wouldn't work
since I use the USB-drive on both Windows and Ubuntu.

***
Once unetbootin is installed, you can use a partition manager to shrink the partition and add one for
your own files after it (gparted would do it perfectly) As for the language change, you can edit the
bootloader to to add kernel parameters, see <help.ubuntu.com/lts/installation-guide/powerpc/? in regard
to debian-installer/language (language), debian-installer/country (country), debian-installer/locale
(locale) to force your required locale

***
This should be easy to do. However, be warned in advanced that Windows will only be able to see the
first partition (/dev/sdb1), the second partition will be invisible (I don't know why). Therefore,
I would recommend the general-purpose storage partition be the first one, and the LiveUSB partition be
the second one.

If after doing this, you can't get the key to boot, you should be able to set the Boot flag using GParted.

Please note: although I've successfully done this before, I've never tested doing something like this
on a UEFI-based system, let alone something that uses Secure Boot.

***
I'm afraid I'll have to argue that point. I, myself have a flash drive which I use both as a LiveUSB version
of Ubuntu, and for general storage. My first partition is an NTFS partition, which works perfectly on both
XP and 7. My second partition is a FAT32 partition, which contains a live version of Ubuntu. I can't even
see this partition from Windows, even from the disk manager (diskmgmt.msc). However, i can boot from it,
and read from/write to it from Ubuntu. See the 4th paragraph HERE.
