filename: defining_program_colors_through_xresources-5p-20251119.txt
https://www.reddit.com/r/unixporn/comments/8giij5/guide_defining_program_colors_through_xresources/

[Guide] Defining program colors through .Xresources

   This post is inspired by an
   [https://www.reddit.com/r/vim/comments/8d61a0/auto_pairing_your_vim_theme_with_your_terminal/]article
   posted on r/vim a week ago on how to automatically pair Vim colors with your terminal theme. While the
   method described in the post work, they rely on pre-existing colorschemes and are only applied to Vim and
   the terminal. Why not take it further?

   I set up almost all my programs to get their colorschemes from my .Xresource file. Even though this
   may take a while to setup at first, this method allows me to define a colorscheme in a single place.
   If I change my colorscheme (which happens quite often), these changes are automatically spread to the
   rest of my programs.

The colorschemes
   My colorscheme files all have the same structure. For instance, taking a modified version of
   u/x_ero's [https://github.com/xero/blaquemagick.vim]blaquemagick:

#define FOREGROUND #c2c2b0
#define BACKGROUND #1c1c1c

#define COLOR0  #1c1c1c
#define COLOR8  #262626
#define COLOR1  #5F8787
#define COLOR9  #5f8787
#define COLOR2  #424242
#define COLOR10 #424242
#define COLOR3  #666666
#define COLOR11 #666666
#define COLOR4  #808080
#define COLOR12 #808080
#define COLOR5  #a8a8a8
#define COLOR13 #a8a8a8
#define COLOR6  #cccccc
#define COLOR14 #cccccc
#define COLOR7  #c2c2b0
#define COLOR15 #c2c2b0

   A couple points are important here:
     * To my knowledge, some programs cannot directly read the foreground and background values defined
       in the first two lines. I make them appear in color0 and color7 respectively to reference them.
     * It is better to group similar colors under the same definition across different colorschemes. For
       instance, I always assign the darkest non-bg color to color8 in my definitions, since this color
       is used for the modelines of Emacs and Vim.

.Xresources
   Once color definitions are set up, you can include them in your .Xresources file. For urxvt, the
   following is enough to have a working terminal colorscheme:

#include "/home/vxid/.xcolors/blaquemagick"

*.foreground:  FOREGROUND
*.background:  BACKGROUND
*.cursorColor: FOREGROUND
*.color0:      COLOR0
*.color8:      COLOR8
...
*.color7:      COLOR7
*.color15:     COLOR15

Referencing colors in different programs
   Now comes the interesting part. The colors defined through .Xresources are available by many
   different programs.

Vim
   To provide an alternative to the article that inspired me to write this post, terminal vim/neovim can
   read .Xresources colors using color codes 0 through 15. For instance:
hi PmenuSel ctermfg=5 ctermbg=8

   Defines the active completion line in Vim to use color5 and color8 for the selected completion
   option.

Emacs
   Gui emacs can simply read Xresources color definitions using this function (found in
   [https://github.com/cqql/xresources-theme]this colorscheme):

(defun xresources-theme-color (name)
	"Read the color NAME from the X resources."
	(x-get-resource name ""))

   It is then rather easy to define variables referencing .Xresources colors:
(let ((class '((class color) (min-colors 89)))
	 (color0 (xresources-theme-color "color0"))
	 (color1 (xresources-theme-color "color1"))
	 ...
	 ...
	 )

   and to use them in a custom theme:
`(highlight           ((,class (:foreground ,color0 :background ,color1))))

i3
   i3 provides a function to read .Xresources colors:
set_from_resource $fg foreground
set_from_resource $bg background
set_from_resource $fbg color8

   These colors are then available in the i3 config file:
client.focused          $fbg $fbg $fbg $fbg
client.focused_inactive $bg  $bg  $bg  $bg
client.unfocused        $bg  $bg  $bg  $bg
client.urgent           $bg  $bg  $bg  $bg

Polybar
   Polybar also reads .Xresources definitions:
background = ${xrdb:background}
foreground = ${xrdb:foreground}
highlight  = ${xrdb:color1}
grey       = ${xrdb:color4}

   You can then use these definitions:
label-unfocused-background = ${colors.background}
label-focused-background   = ${colors.background}
label-urgent-background    = ${colors.highlight}
label-mode-background      = ${colors.background}

Rofi
   I directly set my rofi colorscheme in the .Xresource files:
rofi.color-window: BACKGROUND, BACKGROUND, BACKGROUND
rofi.color-normal: BACKGROUND, FOREGROUND, BACKGROUND, BACKGROUND, COLOR1
rofi.color-active: BACKGROUND, FOREGROUND, BACKGROUND, BACKGROUND, COLOR1
rofi.color-urgent: BACKGROUND, FOREGROUND, BACKGROUND, BACKGROUND, COLOR1

Tmux
   .Xresource colors can be directly referenced in tmux-conf:
set -g window-status-format         "#[fg=colour2]#[bg=colour0] #W "
set -g window-status-current-format "#[fg=colour7]#[bg=colour0] #W "

Dunst
   Dunst is more complicated to configure since it is not Xorg-specific. It however accepts color
   arguments when it is started. I added this line in my i3 config
exec_always --no-startup-id dunst -lb "$bg" -nb "$bg" -cb "$bg" -lf "$fg" -bf "fg" -cf "$fg" -nf "$fg" \
	-fn "ypn envypn 12" -s -geometry "400x60-10+40" -format "<b>%s</b>\n%b" -shrink  -lto 3 -nto 5 -cto 0 \
	-align "left" -transparency 0 -padding 8 -horizontal_padding 8

   to run dunst without a dunstrc file and pass my terminal colors as arguments through my i3 config
   file.

Limitations
   Some programs like zathura cannot (to my knowledge) read .Xresource colors directly. It is also not
   possible to define userChrome.css (Firefox colors) or GTK themes directly without some ugly scripting
   involved. However, [https://github.com/themix-project/oomox]oomox makes it easy to define a matching
   colorscheme.

   Feel free of course to add working solutions for other programs that I may not know of or correct me
   if I was wrong somewhere.

   My dots can be found [https://github.com/vxid/dots]here if anyone wants to see in detail how my system
   works.


---
Comments:

***
You can do something like this for zathura:

#!/bin/sh

# Generates zathura configuration file

. $HOME/.cache/wal/colors.sh

cat <<CONF
set completion-bg "$background"
set completion-fg "$foreground"
set completion-group-bg "$background"
set completion-group-fg "$color2"
set completion-highlight-bg "$foreground"
set completion-highlight-fg "$background"
set default-bg "$background"
set default-fg "$foreground"
set inputbar-bg "$background"
set inputbar-fg "$foreground"
set notification-bg "$background"
set notification-fg "$foreground"
set notification-error-bg "$color1"
set notification-error-fg "$foreground"
set notification-warning-bg "$color1"
set notification-warning-fg "$foreground"
set statusbar-bg "$background"
set statusbar-fg "$foreground"
set index-bg "$background"
set index-fg "$foreground"
set index-active-bg "$foreground"
set index-active-fg "$background"
set render-loading-bg "$background"
set render-loading-fg "$foreground"

set smooth-scroll true
set window-title-home-tilde true
set statusbar-basename true
set selection-clipboard clipboard
CONF

Save this script (genzathurarc) and call it like this to generate zathurarc
$> mkdir -pv $HOME/.config/zathura && genzathurarc > $HOME/.config/zathura/zathurarc

If you don't use wal, you can use this function in the script (outsite the heredoc) to get colors from xrdb:

get_xres() {
	xrdb -query | grep $1 | awk '{print $2}'
}

Use it like this:
set default-bg "$(get_xres background:)"

***
So. This is UNIX. If there is a will, there is a way. For applications which do not support .Xresources, I
have come up with a pretty satisfactory method of propagating the settings. Let's use alacritty for example.

Alacritty stores its settings - including its colors - in ~/.config/alacritty.yml. Copy that file to
alacritty.yml.in. Now, replace all the colors with placeholder tokens. My file ends up looking like this
(exerpt):

# Colors
	colors:
	# Default colors
	primary:
		background: %clbg%
		foreground: %clfg%

	# Colors the cursor will use if `custom_cursor_colors` is true
	cursor:
		text: '0x000000'
		cursor: '0xffffff'

	# Normal colors
	normal:
		black:   %cl0%
		red:     %cl1%
		green:   %cl2%
		yellow:  %cl3%
		blue:    %cl4%
		magenta: %cl5%
		cyan:    %cl6%
		white:   %cl7%

	# Bright colors
	bright:
		black:   %cl8%
		red:     %cl9%
		green:   %cl10%
		yellow:  %cl11%
		blue:    %cl12%
		magenta: %cl13%
		cyan:    %cl14%
		white:   %cl15%

Now, we need to lift the color information from our .Xresources, and patch up our alacritty configuration
file. This can be done with xrdb, awk, sed and some bash-fu. Here is the script I ended up with:

#!/bin/bash
# Update alacritty config to apply Xresources color scheme

# Target file
target_file="$HOME/.config/alacritty/alacritty.yml"

# copy input file to temporary file for black magic fuckery
# (alacritty applies colors when the config file is written, so we want to do it
# all in one write)
cp $target_file.in $target_file.tmp

# Grab colors from Xresources
xrdb ~/.config/Xresources

# Numbered colors
for i in {0..15}; do
	v=`xrdb -query | awk '/*.color'"$i":'/ { print substr($2,2) }'`
	#echo $v
	eval "sed -i 's/%cl${i}%/\x270x${v}\x27/g' $target_file.tmp";
done

# Named colors
foreground=`xrdb -query | awk '/*.foreground/ { print substr($2,2) }'`
background=`xrdb -query | awk '/*.background/ { print substr($2,2) }'`
sed -i "s/%clfg%/\x270x${foreground}\x27/g" $target_file.tmp
sed -i "s/%clbg%/\x270x${background}\x27/g" $target_file.tmp

# Finally, replace target file with our updated one
rm $target_file
mv $target_file.tmp $target_file

And there we have it. Call that script in your startup script and you're golden. This technique can be adapted
to many other programs as well.


---


